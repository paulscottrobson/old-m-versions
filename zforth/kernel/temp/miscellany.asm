; ********************************************************************************************************
; ********************************************************************************************************
;
;		Name : 		miscellany.asm
;		Purpose : 	Miscellany
;		Created : 	29th October 2018
;
; ********************************************************************************************************
; ********************************************************************************************************

; ********************************************************************************************************
;
;											Halt the CPU
;
; ********************************************************************************************************

__zfdefine_68_61_6c_74:
; @word halt
		jp 		HaltZ80

; ********************************************************************************************************
;
;							Get address / size of editing buffer
;
; ********************************************************************************************************

__zfdefine_65_64_69_74_2e_62_75_66_66_65_72:
; @word edit.buffer

		ex 		de,hl
		ld 		hl,EditBuffer
		ret

__zfdefine_65_64_69_74_2e_62_75_66_66_65_72_2e_73_69_7a_65:
; @word edit.buffer.size

		ex 		de,hl
		ld 		hl,EditBufferSize
		ret

; ********************************************************************************************************
;
;						 Return address of system information table
;
; ********************************************************************************************************

__zfdefine_73_79_73_2e_69_6e_66_6f:
; @word sys.info
		ex 		de,hl
		ld 		hl,SystemInformation
		ret

; ********************************************************************************************************
;
;						discard the return stack except for one level
;
; ********************************************************************************************************

__zfdefine_73_74_61_63_6b_2e_72_65_73_65_74:
; @word stack.reset

		pop 	hl 									; so we know where to return to.
		ld 		sp,(SIStack)						; load the stack pointer
		jp 		(hl)								; do the return.

; ********************************************************************************************************
;
;				incomplete branch handler - used for forward branches as a dummy target
;
; ********************************************************************************************************

__zfdefine_69_6e_63_6f_6d_70_6c_65_74_65_2e_62_72_61_6e_63_68:
; @word incomplete.branch

		ex 		de,hl
		ld 		hl,__ICBranchError
		ret
__ICBranchError:
		ld 		hl,__ICBranchText
		jp 		ErrorHandlerHL
__ICBranchText:
		db 		"Come across an unclosed branch (if without then ?)",0

; ********************************************************************************************************
;
;								Image save routines (rely on bootloader)
;
; ********************************************************************************************************

__zfdefine_73_61_76_65:
; @word save

		jp 		$7FF9
