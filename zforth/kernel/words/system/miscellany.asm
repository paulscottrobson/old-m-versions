; ********************************************************************************************************
; ********************************************************************************************************
;
;		Name : 		miscellany.asm
;		Author : 	Paul Robson (paul@robsons.org.uk)
;		Purpose : 	Miscellany
;		Created : 	29th October 2018
;
; ********************************************************************************************************
; ********************************************************************************************************

; ********************************************************************************************************
;
;											Halt the CPU
;
; ********************************************************************************************************

; @word halt
		jp 		HaltZ80

; ********************************************************************************************************
;
;							Get address / size of editing buffer
;
; ********************************************************************************************************

; @word edit.buffer
		
		ex 		de,hl
		ld 		hl,EditBuffer
		ret

; @word edit.buffer.size

		ex 		de,hl
		ld 		hl,EditBufferSize
		ret

; ********************************************************************************************************
;
;						 Return address of system information table
;
; ********************************************************************************************************

; @word sys.info
		ex 		de,hl
		ld 		hl,SystemInformation
		ret

; ********************************************************************************************************
;
;						discard the return stack except for one level
;
; ********************************************************************************************************

; @word stack.reset

		pop 	hl 									; so we know where to return to.
		ld 		sp,(SIStack)						; load the stack pointer
		jp 		(hl)								; do the return.

; ********************************************************************************************************
;
;				incomplete branch handler - used for forward branches as a dummy target
;
; ********************************************************************************************************

; @word incomplete.branch

		ex 		de,hl
		ld 		hl,__ICBranchError
		ret
__ICBranchError:
		ld 		hl,__ICBranchText
		jp 		ErrorHandlerHL
__ICBranchText:
		db 		"Come across an unclosed branch (if without then ?)",0
		
; ********************************************************************************************************
;
;								Image save routines (rely on bootloader)
;
; ********************************************************************************************************
	
; @word save

		jp 		$7FF9
